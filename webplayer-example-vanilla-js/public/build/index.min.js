"use strict";export const allowedEvents={success:1,error:1,someOtherEvent:1,somePublicMethodResponse:1},allowedMethods={somePublicMethod:1};class c{constructor({token:e,domain:o,deviceId:t,containerId:s}){this._token=e,this._appendedChild=null,this._domain=o,this._deviceId=t,this._containerId=s,this._connection=null,this._remoteHandle=null,this._localHandle=null,this._listeners={},this.setupPostMe().then(()=>{this.setupIframe()!==void 0&&this._appendedChild&&window.PostMe&&this.setupCommunication(this._appendedChild,window.PostMe)}).catch(()=>{throw console.error("Could not set up communication with the Corellium iframe."),new Error("Could not set up communication with the Corellium iframe.")})}async setupPostMe(){return new Promise((e,o)=>{import("https://unpkg.com/post-me/dist/index.js").then(()=>{e(!0)}).catch(t=>{console.error("Error setting up post-me."),o()})})}setupIframe(){const e=`${this._domain}/web-player/login`,o=document.getElementById(this._containerId),t=document.createElement("iframe");if(t.src=e,t.name="child",t.title="Corellium Web Player",t.width="100%",t.style.border="none",t.id="web-player",t.style.display="none",t.style.minHeight="800px",t.style.maxHeight="100%",t.style.margin="0",t.allow="camera;microphone",o)return this._appendedChild=o.appendChild(t),this._appendedChild;throw new Error("Could not append child to container.")}setupCommunication(e,o){e.onload=()=>{if(!e.contentWindow)throw new Error("Could not get contentWindow from iframe.");const t=o.WindowMessenger,s=o.ParentHandshake,l=new t({localWindow:window,remoteWindow:e.contentWindow,remoteOrigin:this._domain});s(l,{},10,5e3).then(i=>(this._connection=i,this._remoteHandle=i.remoteHandle(),this._localHandle=i.localHandle(),this._localHandle.emit("connect",{token:this._token,deviceId:this._deviceId}),this._remoteHandle.addEventListener("message",n=>{if(n.status==="success")setTimeout(()=>{const r=document.getElementById("corellium-loading"),d=document.getElementById("web-player");if(r&&(r.style.display="none"),!d)throw new Error("Could not find web-player element.");d.style.display="block",this._emit(n.status,n)},2e3);else if(n.status==="error"){const r=document.getElementById("corellium-error");throw r&&(r.style.display="block"),this._emit(n.status,n),new Error(n)}else this._emit(n.status,n)}),{status:200,message:"success"})).catch(i=>{throw this._emit("error",i),new Error(i)})}}on(e,o){if(!allowedEvents[e])throw new Error(`${e} is not allowed`);this._listeners[e]=o}_emit(e,o){this._listeners?.[e](o)}exec(e,o){if(!allowedMethods[e])throw new Error(`${e} is not allowed`);this._remoteHandle?.call(e,o)}}export default c;
//# sourceMappingURL=index.min.js.map
